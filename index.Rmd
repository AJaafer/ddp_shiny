---
title       : Interactive Machine Learning Shiny Application
subtitle    : "Kaggle - Titanic: Machine Learning from Disaster"
author      : Coursera TJF
job         : 
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : []            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}

--- intro

```{r init, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}
# packages
library(knitr)
library(data.table)
library(caret)
library(randomForest)
library(plyr)
library(dplyr)
library(xtable)

# urls to raw data
test.url <- 'https://github.com/coursera-tjf/ddp_shiny/raw/master/data/test.csv'
train.url <- 'https://github.com/coursera-tjf/ddp_shiny/raw/master/data/train.csv'

# functions
getProcessData <- function(p) {
  # read in raw data
  raw.training.all <- fread(train.url)
  # handle all missing values - for right now, only use complete cases
  raw.training.all <- raw.training.all[complete.cases(raw.training.all),]
  raw.training.outcome <- raw.training.all[,"Survived",with=F]
  raw.training.predictors <- raw.training.all[,-"Survived",with=F]
  raw.testing.predictors <- fread(test.url)

  # process data by adding factors for Survived, Pclass, Sex, and Embarked
  process.data <- function(x) {
    # factorize some variables
    if ('Survived' %in% colnames(x))
      x$Survived <- factor(x$Survived, levels=c(0,1), labels=c('No', 'Yes'))
    x$Pclass <- factor(x$Pclass, levels=c(1,2,3), labels=c('1st', '2nd', '3rd'))
    x$Sex <- factor(x$Sex, levels=c('male', 'female'), labels=c('male', 'female'))
    x$Embarked <- factor(x$Embarked, levels=c('C', 'Q', 'S'),
      labels=c('Cherbourg', 'Queenstown', 'Southampton'))
    # factorize rest to use caret package for analysis
    x$Name <- factor(x$Name)
    x$Ticket <- factor(x$Ticket)
    x$Cabin <- factor(x$Cabin)
    x
  }
  # process data
  proc.training.all <- process.data(raw.training.all)
  proc.training.outcome <- proc.training.all[,"Survived", with=F]
  proc.training.predictors <- proc.training.all[,-"Survived",with=F]
  proc.testing.predictors <- process.data(raw.testing.predictors)
  
  # create initial training, validation, and training sets
  inValidation <- createDataPartition(y=proc.training.outcome$Survived, p=p/100, list=FALSE)
  proc.validation <- proc.training.all[inValidation,]
  proc.training <- proc.training.all[-inValidation,]
  proc.testing <- proc.testing.predictors
  # raw version
  raw.validation <- raw.training.all[inValidation,]
  raw.training <- raw.training.all[-inValidation,]
  raw.testing <- raw.testing.predictors
  # bundle into list for use
  list(rtr=raw.training, rv=raw.validation, rte=raw.testing, ptr=proc.training,
    pv=proc.validation, pte=proc.testing)
}

```

## Interactive Machine Learning Example

* Uses Kaggle "Getting Started" Competition [Titanic: Machine Learning from
Disaster](https://www.kaggle.com/c/titanic)
* Purpose: Use machine learning to predict who survived the titanic disaster
* Contains:
  1. Data summary (raw and processed as well as training, validation, and testing data)
  2. Interactive exploratory data analysis (one and two variable as well as
pair plots)
  3. Interactive model creation (data preprocessing, feature selection, and
machine learning algorithm selection)
  4. Model evaluation (in-sample error via training data and out-of-sample
error via validation data)
  5. Test data results (model applied to testing data to predict survival)

#### Deployed Shiny App and Code Publically Available
* shinyapps.io URL: https://coursera-tjf.shinyapps.io/ddp_shiny/
* Code and data available in github repository:
https://github.com/coursera-tjf/ddp_shiny


--- &twocol w1:40% w2:60%
## Data summary and Pairs Plot

*** =left

```{r echo=F}
# get data
if (!exists('dat'))
  dat <- getProcessData(40)
name.type <- data.frame(colnames=colnames(dat$ptr),
  type=sapply(dat$ptr, class))
kable(name.type)
#summary(dat$ptr[,-c('Name', 'Ticket', 'Cabin'), with=F])
```

*** =right

```{r pairs_plot, echo=F}
xcolsIgnore <- c('PassengerId', 'Name','Ticket', 'Cabin')
featurePlot(x=dat$ptr[,-xcolsIgnore, with=F], 
  y=dat$ptr$Survived, 
  plot='pairs', auto.key=list(columns=2))
```

--- 

## Build prediction model

* Preprocessing = center, scale, BoxCox
* Method = Random Forests
* Data = Training data set

```{r build_model, echo=F}
if (!exists('modelFit'))
  modelFit <- train(Survived ~ Age + Sex + Pclass, data=dat$ptr, method='rf',
    preProcess=c('center', 'scale', 'BoxCox'))
modelFit
```

---

## Evaluate model performance (using verification data)

```{r eval_model, echo=F}
  confusionMatrix(predict(modelFit, dat$pv), dat$pv$Survived)
```
